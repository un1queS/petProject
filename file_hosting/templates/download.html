{% extends "base.html" %}

{% block title %}{{ file.original_name }} · Детали{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card shadow-sm border-0">
      <div class="card-body p-5">
        <h1 class="h4 mb-4">{{ file.original_name }}</h1>
        <div class="row g-4">
          <div class="col-md-6">
            <dl class="mb-0">
              <dt>Загружено</dt>
              <dd>{{ file.uploaded_at.strftime("%d %b %Y %H:%M") }}</dd>
              <dt>Размер файла</dt>
              <dd>{{ (file.file_size / 1024) | round(1) }} КБ</dd>
              <dt>Тип</dt>
              <dd>{{ file.mime_type or "Неизвестно" }}</dd>
            </dl>
          </div>
          <div class="col-md-6">
            <dl class="mb-0">
              <dt>Скачиваний</dt>
              <dd>{{ file.download_count }}</dd>
              <dt>Описание</dt>
              <dd>{{ file.description or "Описание не предоставлено." }}</dd>
              <dt>ID файла</dt>
              <dd>#{{ file.id }}</dd>
            </dl>
          </div>
        </div>

        <div class="d-flex gap-3 mt-4">
          <a class="btn btn-primary" href="{{ url_for('download', file_id=file.id) }}">Скачать</a>
          {% if file.is_public and file.share_token %}
            <div class="d-flex align-items-center gap-2">
              <span class="badge bg-success">Публичная ссылка активна</span>
              <button class="btn btn-sm btn-outline-secondary" onclick="copyShareLink()">Копировать ссылку</button>
            </div>
            <input type="hidden" id="shareUrl" value="{{ url_for('share_view', token=file.share_token, _external=True) }}">
          {% else %}
            <form method="post" action="{{ url_for('toggle_share', file_id=file.id) }}" class="d-inline">
              <button class="btn btn-outline-success" type="submit">Создать публичную ссылку</button>
            </form>
          {% endif %}
          <a class="btn btn-outline-secondary" href="{{ url_for('dashboard') }}">Назад к файлам</a>
        </div>
        {% if file.is_public and file.share_token %}
          <div class="alert alert-info mt-3">
            <strong>Публичная ссылка:</strong><br>
            <code id="shareLinkText">{{ url_for('share_view', token=file.share_token, _external=True) }}</code>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
function copyShareLink() {
  const shareUrl = document.getElementById('shareUrl').value;
  navigator.clipboard.writeText(shareUrl).then(function() {
    alert('Ссылка скопирована в буфер обмена!');
  });
}
</script>
{% endblock %}

