{% extends "base.html" %}

{% block title %}Мои файлы · {{ config.SITE_NAME }}{% endblock %}

{% block content %}
<div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
  <div>
    <h1 class="h3 mb-1">Моя библиотека</h1>
    <p class="text-muted mb-0">У вас сохранено {{ files|length }} файлов · Общий размер {{ (total_size / (1024 * 1024)) | round(2) }} МБ</p>
  </div>
  <a class="btn btn-primary" href="{{ url_for('upload') }}"><span class="me-2">+</span>Загрузить</a>
</div>

{% if files %}
  <div class="table-responsive shadow-sm rounded-4">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th scope="col">Имя</th>
          <th scope="col">Загружено</th>
          <th scope="col">Размер</th>
          <th scope="col">Скачиваний</th>
          <th scope="col" class="text-end">Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for file in files %}
          <tr>
            <td>
              <div class="fw-semibold">{{ file.original_name }}</div>
              {% if file.description %}
                <div class="text-muted small">{{ file.description }}</div>
              {% endif %}
            </td>
            <td>{{ file.uploaded_at.strftime("%d %b %Y %H:%M") }}</td>
            <td>{{ (file.file_size / 1024) | round(1) }} KB</td>
            <td>{{ file.download_count }}</td>
            <td class="text-end">
              <div class="btn-group btn-group-sm" role="group">
                <a class="btn btn-outline-primary" href="{{ url_for('file_detail', file_id=file.id) }}">Детали</a>
                <a class="btn btn-primary" href="{{ url_for('download', file_id=file.id) }}">Скачать</a>
                <form class="d-inline" action="{{ url_for('delete', file_id=file.id) }}" method="post" onsubmit="return confirm('Удалить {{ file.original_name }}?');">
                  <button class="btn btn-outline-danger" type="submit">Удалить</button>
                </form>
              </div>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="text-center py-5 border rounded-4">
    <p class="lead mb-1">Вы еще ничего не загрузили.</p>
    <p class="text-muted mb-4">Загрузите свой первый файл, чтобы увидеть его здесь.</p>
    <a class="btn btn-primary" href="{{ url_for('upload') }}">Загрузить файл</a>
  </div>
{% endif %}
{% endblock %}

